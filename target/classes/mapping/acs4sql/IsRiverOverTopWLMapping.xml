<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.jxztev.dao.acs4sql.IIsRiverOverTopWLDao">
    <resultMap id="IsRiverOverTopWLResultMap" type="com.jxztev.entity.acs4sql.IsRiverOverTopWLResponse">
        <result property="cwrz" column="cwrz" javaType="String"
                jdbcType="VARCHAR"/>
    </resultMap>

    <select id="isRiverOverTopWLHandler" parameterType="com.jxztev.entity.acs4sql.IsRiverOverTopWLRequest"
            resultMap="IsRiverOverTopWLResultMap">
        <![CDATA[ select max(b.z - c.wrz) as cwrz from ( select stcd,stnm,( select max(tm) from st_river_r where stcd = p.stcd and tm >= to_date(#{bgTm}, 'yyyy-mm-dd hh:mi:ss') and tm < to_date(#{endTm}, 'yyyy-mm-dd hh:mi:ss') ) as tm from st_stbprp_b p ]]>
        where p.stcd in <foreach collection="stationsList" index="index" item="item" open="(" separator="," close=")">
        #{item}
    </foreach> ) a left join st_river_r b on a.stcd = b.stcd and a.tm = b.tm left join st_rvfcch_b c on a.stcd = c.stcd
    </select>
</mapper>
